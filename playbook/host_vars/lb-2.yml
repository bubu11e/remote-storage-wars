---

consul_template_template_templates:
  - src: "templates/haproxy-timescale.ctmpl.j2"
    dest: "haproxy.ctmpl"
    cmd: "systemctl reload consul-template.service"
    perms: "0600"
    backup: "true"
    wait: "2s"

consul_services:
  - name: "node-exporter"
    id: "node-exporter"
    address: "{{ private_ip }}"
    port: 9100
    checks:
      - tcp: "{{ private_ip }}:9100"
        interval: "10s"
  - name: "haproxy-exporter"
    id: "haproxy-exporter"
    address: "{{ private_ip }}"
    port: 9101
    checks:
      - http: http://localhost:9101/health
        interval: "10s"
  - name: "timescaledb-rw"
    id: "timescaledb-rw"
    address: "{{ private_ip }}"
    port: 3000
    checks:
      - tcp: "{{ private_ip }}:3000"
        interval: "10s"
  - name: "timescaledb-ro"
    id: "timescaledb-ro"
    address: "{{ private_ip }}"
    port: 4000
    checks:
      - tcp: "{{ private_ip }}:4000"
        interval: "10s"
  - name: "promscale"
    id: "promscale"
    address: "{{ private_ip }}"
    port: 9201
    checks:
      - tcp: "{{ private_ip }}:9201"
        interval: "10s"
    tags:
      - ro
      - rw
