---
timescale_prometheus_limitnofile: 1048576
timescale_prometheus_cfg:
  TS_PROM_DB_HOST: rw.timescaledb.service.consul
  TS_PROM_DB_PORT: 3000
  TS_PROM_DB_NAME: timescale
  TS_PROM_DB_PASSWORD: timescale
  TS_PROM_DB_USER: timescale
consul_services:
  - name: "node-exporter"
    id: "node-exporter"
    address: "{{ private_ip }}"
    port: 8888
    checks:
      - tcp: "localhost:9100"
        interval: "10s"
  - name: "nginx-exporter"
    id: "nginx-exporter"
    address: "{{ private_ip }}"
    port: 8888
    checks:
      - tcp: "localhost:8080"
        interval: "10s"
  - name: "promscale-exporter"
    id: "promscale-exporter"
    address: "{{ private_ip }}"
    port: 8888
    checks:
      - http: "http://{{ private_ip }}:9201/healthz"
        interval: "10s"
  - name: "promscale"
    id: "promscale"
    address: "{{ private_ip }}"
    port: 9201
    checks:
      - http: "http://{{ private_ip }}:9201/healthz"
        interval: "10s"
    tags:
      - node

nginx_config_http_template:
  app:
    servers:
      main:
        reverse_proxy:
          locations:
            promscale_exporter:
              location: /promscale_exporter/
              proxy_cache: exporter
              proxy_pass: "http://localhost:9201/"
              proxy_cache_background_update: false
              proxy_cache_lock: true
              proxy_cache_min_uses: 1
              proxy_set_header:
                header_host:
                  name: Host
                  value: $host
