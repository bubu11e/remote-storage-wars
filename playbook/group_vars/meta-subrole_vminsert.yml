---
# Add extra variables here . Found more options with vminsert-prod --help
victoriametrics_vminsert_service_args: "-replicationFactor=3"
victoriametrics_vminsert_memory_allowed_percent: "60"

consul_services:
  - name: "node-exporter"
    id: "node-exporter"
    address: "{{ private_ip }}"
    port: 8888
    checks:
      - tcp: "localhost:9100"
        interval: "10s"
  - name: "nginx-exporter"
    id: "nginx-exporter"
    address: "{{ private_ip }}"
    port: 8888
    checks:
      - tcp: "localhost:8080"
        interval: "10s"
  - name: "victoriametrics-exporter"
    id: "victoriametrics-exporter"
    address: "{{ private_ip }}"
    port: 8888
    checks:
      - http: http://localhost:8480/health
        interval: "10s"
  - name: "victoriametrics"
    id: "victoriametrics"
    address: "{{ private_ip }}"
    port: 8480
    checks:
      - http: http://localhost:8480/health
        interval: "10s"
    tags:
      - insert

nginx_config_http_template:
  app:
    servers:
      main:
        reverse_proxy:
          locations:
            victoriametrics_exporter:
              location: /victoriametrics_exporter/
              proxy_cache: exporter
              proxy_pass: "http://localhost:8480/"
              proxy_cache_background_update: false
              proxy_cache_lock: true
              proxy_cache_min_uses: 1
              proxy_set_header:
                header_host:
                  name: Host
                  value: $host
